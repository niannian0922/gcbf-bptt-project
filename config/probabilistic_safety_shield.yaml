# ğŸ›¡ï¸ PROBABILISTIC SAFETY SHIELD æ¦‚ç‡å®‰å…¨é˜²æŠ¤ç½©é…ç½®
# é‡å¤§æ¶æ„é‡æ„ï¼šå°†GCBF+è½¬æ¢ä¸ºæ¦‚ç‡å®‰å…¨é˜²æŠ¤ç½©

description: "ğŸ›¡ï¸ æ¦‚ç‡å®‰å…¨é˜²æŠ¤ç½© - è§£è€¦å®‰å…¨ä¸æ•ˆç‡ç›®æ ‡çš„é©å‘½æ€§æ¶æ„"
run_name: "probabilistic_safety_shield"

# ç¯å¢ƒå‚æ•°
env:
  num_agents: 2
  area_size: 2.0
  agent_radius: 0.2
  comm_radius: 1.0
  mass: 0.1
  dt: 0.05
  max_force: 1.0
  cbf_alpha: 1.0
  max_steps: 200

  # éšœç¢ç‰©é…ç½® - å¢åŠ æŒ‘æˆ˜æ€§ä»¥æµ‹è¯•é˜²æŠ¤ç½©
  obstacles:
    enabled: true
    count: 2
    radius: 0.1

  # GCBFå®‰å…¨å±‚é…ç½®
  safety_layer:
    enabled: true
    alpha: 1.0
    eps: 0.02
    safety_margin: 0.08
    # ğŸ›¡ï¸ æ¦‚ç‡é˜²æŠ¤ç½©ç‰¹æœ‰å‚æ•°
    safety_sharpness: 2.0  # kå‚æ•°ï¼šæ§åˆ¶å®‰å…¨ä¿¡å¿ƒåˆ†æ•°è¿‡æ¸¡çš„é”åˆ©åº¦
    use_qp: false  # ç®€åŒ–è®¡ç®—ï¼Œä¸ä½¿ç”¨QPæ±‚è§£å™¨

# ç½‘ç»œå‚æ•°
networks:
  policy:
    perception:
      use_vision: false
      input_dim: 9  # ä½ç½®(2) + é€Ÿåº¦(2) + ç›®æ ‡(2) + éšœç¢ç‰©(3)
      hidden_dim: 64
      activation: relu
    memory:
      hidden_dim: 128
      num_layers: 1
    policy_head:
      input_dim: 128
      output_dim: 2
      hidden_dims: [256]
      activation: relu
      predict_alpha: true
      predict_margin: true

  cbf:
    alpha: 1.0
    eps: 0.02
    safety_margin: 0.2

# ğŸ›¡ï¸ æ¦‚ç‡å®‰å…¨é˜²æŠ¤ç½©è®­ç»ƒé…ç½®
training:
  training_steps: 2000  # è¾ƒçŸ­çš„è®­ç»ƒä»¥å¿«é€ŸéªŒè¯
  horizon_length: 20
  eval_interval: 400
  save_interval: 800
  eval_horizon: 30
  max_grad_norm: 1.0

  # å­¦ä¹ ç‡
  policy_lr: 3e-4
  cbf_lr: 1e-3  # CBFç½‘ç»œç°åœ¨éœ€è¦æ›´å°å¿ƒçš„è®­ç»ƒä½œä¸ºé£é™©è¯„ä¼°å™¨

  # ğŸ›¡ï¸ æ–°çš„æŸå¤±æƒé‡é…ç½® - ä¸“ä¸ºæ¦‚ç‡é˜²æŠ¤ç½©è°ƒæ•´
  goal_weight: 1.0
  safety_weight: 2.0     # å¢åŠ å®‰å…¨æƒé‡ï¼Œå› ä¸ºç°åœ¨è®­ç»ƒé£é™©è¯„ä¼°å™¨
  control_weight: 0.01
  alpha_reg_weight: 0.05  # ä»ç„¶é¼“åŠ±æ•ˆç‡
  progress_weight: 0.1

  # æ§åˆ¶æ­£åˆ™åŒ–
  acceleration_loss_weight: 0.02
  jerk_weight: 0.01

  # ğŸ›¡ï¸ æ¦‚ç‡é˜²æŠ¤ç½©ç‰¹æœ‰å‚æ•°
  use_probabilistic_shield: true  # å¯ç”¨æ–°æ¶æ„

  # è‡ªé€‚åº”å®‰å…¨è£•åº¦ï¼ˆä¸é˜²æŠ¤ç½©é…åˆï¼‰
  use_adaptive_margin: true
  min_safety_margin: 0.05
  max_safety_margin: 0.15
  margin_reg_weight: 0.1

# è¯„ä¼°é…ç½®
evaluation:
  episodes: 10
  max_steps: 100
  render: false

# æ—¥å¿—é…ç½®
logging:
  use_wandb: false  # ç¦»çº¿æ¨¡å¼
  log_interval: 100
  save_logs: true